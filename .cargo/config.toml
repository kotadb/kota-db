[alias]
# Development aliases
test-all = "test --all --all-features"
test-unit = "test --lib"
test-integration = "test --test '*'"
test-doc = "test --doc"
test-fast = "test --lib --release"

# Quality checks
check-all = "check --all --all-features --all-targets"
clippy-all = "clippy --all --all-features --all-targets -- -D warnings"
fmt-check = "fmt --all -- --check"
audit-fix = "audit --fix"

# Performance and profiling
bench-all = "bench --all --features bench"
profile = "build --release --bin kotadb"

# Documentation
doc-open = "doc --open --no-deps"
doc-all = "doc --all --all-features --no-deps"

# Cleanup
clean-all = "clean && rm -rf target"

[build]
# Enable parallel compilation (auto-detect cores)
# jobs = 0 is invalid, omit for auto-detection
# Ensure local target directory is used (fixes Issue #296)
target-dir = "target"

[target.x86_64-unknown-linux-gnu]
linker = "clang"
rustflags = ["-C", "link-arg=-fuse-ld=lld"]

[target.x86_64-apple-darwin]
# Rely on the system default linker on macOS runners to avoid relying on lld.
# macOS hosted agents do not include lld by default and we prefer portability.


# Development profile optimizations
[profile.dev]
opt-level = 0
debug = 2
debug-assertions = true
overflow-checks = true
lto = false
panic = 'unwind'
incremental = true
codegen-units = 256
rpath = false

# Test profile for faster tests
[profile.test]
opt-level = 1
debug = 2
debug-assertions = true
overflow-checks = true
lto = false
incremental = true

# Fast compilation profile
[profile.dev.package."*"]
opt-level = 3
debug = false

[env]
RUST_BACKTRACE = "1"
RUST_LOG = "kotadb=debug"
ORT_PREFER_DYNAMIC_LINK = "1"
